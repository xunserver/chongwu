{
  "id": "snapshot_1769601317735_5ie4zmg32",
  "approvalId": "approval_1769601317731_say400bgt",
  "approvalTitle": "修复登录页邮箱验证 Bug - Tasks 阶段",
  "version": 1,
  "timestamp": "2026-01-28T11:55:17.735Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# 实现任务列表\n\n## Phase 1: 修复核心 Bug\n\n- [ ] 1. 修复 LoginView 邮箱验证逻辑\n  - File: src/features/auth/views/LoginView.vue\n  - 修改邮箱字段验证器的 onChange 回调逻辑\n  - 将 `if (!validators.email(value)) return '邮箱格式不正确'` 改为 `const emailError = validators.email(value); if (emailError) return emailError`\n  - Purpose: 修复验证器返回值处理错误，使有效邮箱能正确通过验证\n  - _Leverage: src/features/auth/utils/validators.ts_\n  - _Requirements: Requirement 1, Requirement 2_\n  - _Prompt: Implement the task for spec fix-login-email-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Vue 3 前端开发工程师，精通 TanStack Form API | Task: 修复 LoginView.vue 第 80-85 行的邮箱验证逻辑，正确处理 validators.email() 返回的 string | null 类型 | Restrictions: 必须保持其他代码不变，仅修改验证器逻辑，确保 validators.email() 返回 null 时无错误，返回字符串时显示错误 | Success: 有效邮箱（如 test@example.com）不显示错误，无效邮箱（如 test）显示\"请输入有效的邮箱地址\"，空邮箱显示\"邮箱不能为空\"_\n\n## Phase 2: 检查其他视图\n\n- [ ] 2. 检查并修复其他视图的类似问题\n  - File: src/features/auth/views/RegisterView.vue, src/features/auth/views/ForgotPasswordView.vue\n  - 检查这些视图是否使用了相同的错误验证模式\n  - 如有，应用相同的修复\n  - Purpose: 确保所有认证视图的邮箱验证都正确工作\n  - _Requirements: Requirement 2_\n  - _Prompt: Implement the task for spec fix-login-email-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Vue 3 前端开发工程师 | Task: 检查 RegisterView 和 ForgotPasswordView 的邮箱验证逻辑，查找是否存在 `if (!validators.email(value))` 类似的错误模式 | Restrictions: 如果发现问题才修复，如果验证逻辑正确则不修改 | Success: 所有视图的邮箱验证都能正确识别有效和无效邮箱_\n\n## Phase 3: 测试和验证\n\n- [ ] 3. 手动测试修复\n  - File: src/features/auth/views/LoginView.vue\n  - 运行开发服务器 `pnpm dev`\n  - 访问登录页测试各种邮箱输入场景\n  - Purpose: 验证修复有效，确保所有场景都能正确处理\n  - _Requirements: Requirement 1, Requirement 3_\n  - _Prompt: Implement the task for spec fix-login-email-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA 工程师 | Task: 手动测试登录页的邮箱验证功能，测试以下场景：有效邮箱（test@example.com）、无效邮箱（test、@example.com、test@）、空邮箱、带空格的邮箱 | Restrictions: 必须测试所有列出的场景，记录测试结果 | Success: 所有测试场景都符合预期，有效邮箱无错误，无效邮箱显示正确错误消息_\n\n- [ ] 4. 创建单元测试（可选但推荐）\n  - File: tests/features/auth/views/LoginView.test.ts\n  - 为 LoginView 的邮箱验证逻辑编写单元测试\n  - 测试各种邮箱输入场景\n  - Purpose: 确保验证逻辑的正确性，防止回归\n  - _Leverage: tests/features/auth/utils/validators.test.ts_\n  - _Requirements: Requirement 1, Requirement 3_\n  - _Prompt: Implement the task for spec fix-login-email-validation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: 测试工程师，精通 Vitest 和 Vue Test Utils | Task: 为 LoginView 的邮箱验证编写单元测试，覆盖有效邮箱、无效邮箱、空邮箱等场景 | Restrictions: 使用 @vue/test-utils，mock useAuth hook 和 router，测试验证器逻辑 | Success: 所有测试通过，覆盖修复的 bug 场景_\n",
  "fileStats": {
    "size": 3795,
    "lines": 42,
    "lastModified": "2026-01-28T11:55:15.491Z"
  },
  "comments": []
}